String query;

if ("merged".equals(state)) {
    String dateRange = String.format("merged:%sT00:00:00Z..%sT23:59:59Z", since, until);
    query = String.format("is:pr repo:%s/%s author:%s %s",
            orgName, repoName, author, dateRange);
} else {
    String dateRange = String.format("created:%sT00:00:00Z..%sT23:59:59Z", since, until);
    query = String.format("is:pr repo:%s/%s author:%s %s -is:merged",
            orgName, repoName, author, dateRange);
}

HttpHeaders headers = setupHeaders();

// ðŸ”¹ encode APENAS uma vez
String encodedQuery = URLEncoder.encode(query, StandardCharsets.UTF_8);

String url = "https://" + githubOrgProperties.getUrl()
        + "/search/issues?q=" + encodedQuery
        + "&per_page=1";

log.trace("countPullRequests " + LOG_TRACE_REQUEST_URL_PREFIX, url);

// chamada
githubRateLimiter.executeWithRateLimit(
        githubRestTemplate,
        url,
        new HttpEntity<>(headers),
        new ParameterizedTypeReference<GitHubSearchIssuesResponse>() {}
);
