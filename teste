String query;

if ("merged".equals(state)) {
    String dateRange = String.format("merged:%sT00:00:00Z..%sT23:59:59Z", since, until);
    query = String.format("is:pr repo:%s/%s author:%s %s",
            orgName, repoName, author, dateRange);
} else {
    String dateRange = String.format("created:%sT00:00:00Z..%sT23:59:59Z", since, until);
    query = String.format("is:pr repo:%s/%s author:%s %s -is:merged",
            orgName, repoName, author, dateRange);
}

HttpHeaders headers = setupHeaders();

// ENCODE correto do parâmetro
String encodedQuery = UriUtils.encodeQueryParam(query, StandardCharsets.UTF_8);

String urlFinal = String.format(
        "https://%s/search/issues?q=%s&per_page=1",
        githubOrgProperties.getUrl(),
        encodedQuery
);

// Importantíssimo: usar URI.create para evitar double encode
URI uri = URI.create(urlFinal);

log.trace("countPullRequests " + LOG_TRACE_REQUEST_URL_PREFIX, uri);
