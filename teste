String query;

if ("merged".equals(state)) {
    String dateRange = String.format("merged:%sT00:00:00Z..%sT23:59:59Z", since, until);
    query = String.format("is:pr repo:%s/%s author:%s %s",
            orgName, repoName, author, dateRange);
} else {
    String dateRange = String.format("created:%sT00:00:00Z..%sT23:59:59Z", since, until);
    query = String.format("is:pr repo:%s/%s author:%s %s -is:merged",
            orgName, repoName, author, dateRange);
}

HttpHeaders headers = setupHeaders();

String encodedQuery = URLEncoder.encode(query, StandardCharsets.UTF_8);

String url = String.format(
        "https://%s/search/issues?q=%s&per_page=1",
        githubOrgProperties.getUrl(),
        encodedQuery
);

// chamada normal
githubRateLimiter.executeWithRateLimit(
        githubRestTemplate,
        url,
        new HttpEntity<>(headers),
        new ParameterizedTypeReference<GitHubSearchIssuesResponse>() {}
);
