public byte[] zipDirectory(Path directory) throws IOException {
    try (ByteArrayOutputStream baos = new ByteArrayOutputStream();
         ZipOutputStream zos = new ZipOutputStream(baos)) {

        Files.walk(directory)
                .filter(path -> !Files.isDirectory(path))
                .forEach(path -> {
                    try {
                        System.out.println("Processing file: " + path);
                        ZipEntry zipEntry = new ZipEntry(directory.relativize(path).toString());
                        zos.putNextEntry(zipEntry);
                        Files.copy(path, zos);
                        zos.closeEntry();
                    } catch (AccessDeniedException e) {
                        System.err.println("Access denied: " + path);
                    } catch (IOException e) {
                        System.err.println("Error processing file: " + path);
                        e.printStackTrace();
                    }
                });

        zos.finish(); // Finalize o ZIP
        return baos.toByteArray();
    }
}
