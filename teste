global:
  app_stage: qa
  image:
    tag: 91f4d49547afe5c4260cdbe6b712e1062cbb7ecd
  releaseNumber: 0
  jvm_metrics:
    enabled: true
    port: 8081

picpay-ms-v2:
  apis:
    - name: bankpj
      args:
        - "-XX:+UseG1GC"
        - "-XX:MaxRAMPercentage=80"
        - "-Dotel.instrumentation.tomcat.enabled=false"
        - "-Dspring.profiles.active=bankpj"
      envFrom:
        - secretRef:
            name: envs
        - secretRef:
            name: envs-secrets
      externalSecrets:
        - name: default-bankpj
          enabled: true
          type: vault
          mountPath: kubernetes-srvfpj-use1-hom
          path: financial_services_pj/hom/env
          dataFrom:
            - secretFile: ms-edi-pix
        - name: secrets-bankpj
          enabled: true
          type: vault
          mountPath: kubernetes-srvfpj-use1-hom
          path: financial_services_pj/hom/scrt
          dataFrom:
            - secretFile: ms-edi-pix
      workload: srvfpj
      health:
        path: /health
      readiness:
        initialDelaySeconds: 30
        periodSeconds: 5
        successThreshold: 1
        failureThreshold: 3
        timeoutSeconds: 5
      liveness:
        initialDelaySeconds: 200
        periodSeconds: 5
        successThreshold: 1
        failureThreshold: 4
        timeoutSeconds: 5
      hpa:
        enabled: true
        max: 2
        min: 1
        targetCPU: 80
      containerPort: 8080
      image:
        repositoryURI: 289208114389.dkr.ecr.us-east-1.amazonaws.com/picpay-dev/ms-edi-pix
      ingress:
        - enabled: true
          type: internal-microservices
          name: internal-ms-edi-pix-bankpj
          hosts:
            - hostname: ms-edi-pix-bankpj.ms.qa
              path: "/"
      service:
        enabled: true
        name: edi-pix-bankpj
        port: 80
        targetPort: 8080
      podDisruptionBudget:
        enabled: false
      limits_memory: 2Gi
      limits_cpu: 500m
      requests_cpu: 50m
      requests_memory: 1Gi
      lifecycle:
        preStop:
          - "/bin/bash"
          - "-c"
          - "/bin/sleep 20 && kill -QUIT 1"
      rollingDynamicStableScale: true
      rollingUpdateMaxSurge: 25%
      rollingUpdateMaxUnavailable: 0%
      rollouts:
        enabled: true
        type: canary
        abortScaleDownDelaySeconds: 120
        strategyCanarySteps:
          duration: 10m
          weights: 50/100
      analysis:
        enabled: true
        metrics:
          - name: http-request-alive
            interval: 30s
            initialDelay: 30s
            failureLimit: 5
            successCondition: "result == 'OK'"
            provider:
              web:
                url: "http://{{args.canary-service}}:80/health"
                timeoutSeconds: 30
                jsonPath: "{$.status}"

    - name: legacy
      args:
        - "-XX:+UseG1GC"
        - "-XX:MaxRAMPercentage=80"
        - "-Dotel.instrumentation.tomcat.enabled=false"
        - "-Dspring.profiles.active=legacy"
      envFrom:
        - secretRef:
            name: envs
        - secretRef:
            name: envs-secrets
      externalSecrets:
        - name: default-legacy
          enabled: true
          type: vault
          mountPath: kubernetes-srvfpj-use1-hom
          path: financial_services_pj/hom/env
          dataFrom:
            - secretFile: ms-edi-pix
        - name: secrets-legacy
          enabled: true
          type: vault
          mountPath: kubernetes-srvfpj-use1-hom
          path: financial_services_pj/hom/scrt
          dataFrom:
            - secretFile: ms-edi-pix
      workload: srvfpj
      health:
        path: /health
      readiness:
        initialDelaySeconds: 30
        periodSeconds: 5
        successThreshold: 1
        failureThreshold: 3
        timeoutSeconds: 5
      liveness:
        initialDelaySeconds: 200
        periodSeconds: 5
        successThreshold: 1
        failureThreshold: 4
        timeoutSeconds: 5
      hpa:
        enabled: true
        max: 2
        min: 1
        targetCPU: 80
      containerPort: 8080
      image:
        repositoryURI: 289208114389.dkr.ecr.us-east-1.amazonaws.com/picpay-dev/ms-edi-pix
      ingress:
        - enabled: true
          type: internal-microservices
          name: internal-ms-edi-pix-legacy
          hosts:
            - hostname: ms-edi-pix-legacy.ms.qa
              path: "/"
      service:
        enabled: true
        name: edi-pix-legacy
        port: 80
        targetPort: 8080
      podDisruptionBudget:
        enabled: false
      limits_memory: 2Gi
      limits_cpu: 500m
      requests_cpu: 50m
      requests_memory: 1Gi
      lifecycle:
        preStop:
          - "/bin/bash"
          - "-c"
          - "/bin/sleep 20 && kill -QUIT 1"
      rollingDynamicStableScale: true
      rollingUpdateMaxSurge: 25%
      rollingUpdateMaxUnavailable: 0%
      rollouts:
        enabled: true
        type: canary
        abortScaleDownDelaySeconds: 120
        strategyCanarySteps:
          duration: 10m
          weights: 50/100
      analysis:
        enabled: true
        metrics:
          - name: http-request-alive
            interval: 30s
            initialDelay: 30s
            failureLimit: 5
            successCondition: "result == 'OK'"
            provider:
              web:
                url: "http://{{args.canary-service}}:80/health"
                timeoutSeconds: 30
                jsonPath: "{$.status}"

    - name: fnsvcpf
      args:
        - "-XX:+UseG1GC"
        - "-XX:MaxRAMPercentage=80"
        - "-Dotel.instrumentation.tomcat.enabled=false"
        - "-Dspring.profiles.active=fnsvcpf"
      envFrom:
        - secretRef:
            name: envs
        - secretRef:
            name: envs-secrets
      externalSecrets:
        - name: default-fnsvcpf
          enabled: true
          type: vault
          mountPath: kubernetes-srvfpj-use1-hom
          path: financial_services_pj/hom/env
          dataFrom:
            - secretFile: ms-edi-pix
        - name: secrets-fnsvcpf
          enabled: true
          type: vault
          mountPath: kubernetes-srvfpj-use1-hom
          path: financial_services_pj/hom/scrt
          dataFrom:
            - secretFile: ms-edi-pix
      workload: srvfpj
      health:
        path: /health
      readiness:
        initialDelaySeconds: 30
        periodSeconds: 5
        successThreshold: 1
        failureThreshold: 3
        timeoutSeconds: 5
      liveness:
        initialDelaySeconds: 200
        periodSeconds: 5
        successThreshold: 1
        failureThreshold: 4
        timeoutSeconds: 5
      hpa:
        enabled: true
        max: 2
        min: 1
        targetCPU: 80
      containerPort: 8080
      image:
        repositoryURI: 289208114389.dkr.ecr.us-east-1.amazonaws.com/picpay-dev/ms-edi-pix
      ingress:
        - enabled: true
          type: internal-microservices
          name: internal-ms-edi-pix-fnsvcpf
          hosts:
            - hostname: ms-edi-pix-fnsvcpf.ms.qa
              path: "/"
      service:
        enabled: true
        name: edi-pix-fnsvcpf
        port: 80
        targetPort: 8080
      podDisruptionBudget:
        enabled: false
      limits_memory: 2Gi
      limits_cpu: 500m
      requests_cpu: 50m
      requests_memory: 1Gi
      lifecycle:
        preStop:
          - "/bin/bash"
          - "-c"
          - "/bin/sleep 20 && kill -QUIT 1"
      rollingDynamicStableScale: true
      rollingUpdateMaxSurge: 25%
      rollingUpdateMaxUnavailable: 0%
      rollouts:
        enabled: true
        type: canary
        abortScaleDownDelaySeconds: 120
        strategyCanarySteps:
          duration: 10m
          weights: 50/100
      analysis:
        enabled: true
        metrics:
          - name: http-request-alive
            interval: 30s
            initialDelay: 30s
            failureLimit: 5
            successCondition: "result == 'OK'"
            provider:
              web:
                url: "http://{{args.canary-service}}:80/health"
                timeoutSeconds: 30
                jsonPath: "{$.status}"

  workers: []
